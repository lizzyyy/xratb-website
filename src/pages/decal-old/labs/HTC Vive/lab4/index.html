<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/decal/assets/css/just-the-docs-default.css"> <script src="/decal/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Vive Lab 4: Putting It All Together | Extended Reality Development</title><meta name="generator" content="Jekyll v3.9.3" /><meta property="og:title" content="Vive Lab 4: Putting It All Together" /><meta property="og:locale" content="en_US" /><meta name="description" content="Extended Reality Development DeCal" /><meta property="og:description" content="Extended Reality Development DeCal" /><link rel="canonical" href="http://localhost:4000/decal/labs/HTC%20Vive/lab4/" /><meta property="og:url" content="http://localhost:4000/decal/labs/HTC%20Vive/lab4/" /><meta property="og:site_name" content="Extended Reality Development" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Vive Lab 4: Putting It All Together" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Extended Reality Development DeCal","headline":"Vive Lab 4: Putting It All Together","url":"http://localhost:4000/decal/labs/HTC%20Vive/lab4/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/decal/" class="site-title lh-tight"> Extended Reality Development </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/decal/" class="nav-list-link">Home / Announcements</a><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Homework category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/decal/homework/" class="nav-list-link">Homework</a><ul class="nav-list "><li class="nav-list-item "><a href="/decal/homework/hw1/" class="nav-list-link">Homework 1: The Rube Goldberg Ball Machine</a><li class="nav-list-item "><a href="/decal/homework/hw2/" class="nav-list-link">Homework 2: Music Visualizer</a><li class="nav-list-item "><a href="/decal/homework/hw3/" class="nav-list-link">Homework 3: Fractal Generation</a><li class="nav-list-item "><a href="/decal/homework/hw4/" class="nav-list-link">Homework 4: Pong</a><li class="nav-list-item "><a href="/decal/homework/hw5/" class="nav-list-link">Homework 5: Collisions, Raycasting, and Triggers</a></ul><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in Labs category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/decal/labs/" class="nav-list-link">Labs</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Oculus category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/decal/labs/Oculus/" class="nav-list-link">Oculus</a><ul class="nav-list"><li class="nav-list-item "> <a href="/decal/labs/Oculus/lab1/" class="nav-list-link">Oculus Lab 1: Building the Environment</a><li class="nav-list-item "> <a href="/decal/labs/Oculus/lab2/" class="nav-list-link">Oculus Lab 2: Building the Gun</a><li class="nav-list-item "> <a href="/decal/labs/Oculus/lab3/" class="nav-list-link">Oculus Lab 3: The Monster</a><li class="nav-list-item "> <a href="/decal/labs/Oculus/lab4/" class="nav-list-link">Oculus Lab 4: Putting It All Together</a></ul><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in AR Foundation category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/decal/labs/AR%20Foundation/" class="nav-list-link">AR Foundation</a><ul class="nav-list"><li class="nav-list-item "> <a href="/decal/labs/AR%20Foundation/lab1/" class="nav-list-link">AR Foundation Lab 1: Project Setup / Building the Environment</a><li class="nav-list-item "> <a href="/decal/labs/AR%20Foundation/lab2/" class="nav-list-link">AR Foundation Lab 2: Building the Gun</a><li class="nav-list-item "> <a href="/decal/labs/AR%20Foundation/lab3/" class="nav-list-link">AR Foundation Lab 3: The Monster</a><li class="nav-list-item "> <a href="/decal/labs/AR%20Foundation/lab4/" class="nav-list-link">AR Foundation Lab 4: Putting It All Together</a><li class="nav-list-item "> <a href="/decal/labs/AR%20Foundation/lab5/" class="nav-list-link">AR Foundation Lab 5: Image Tracking, Health Bar</a></ul><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in HTC Vive category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/decal/labs/HTC%20Vive/" class="nav-list-link">HTC Vive</a><ul class="nav-list"><li class="nav-list-item "> <a href="/decal/labs/HTC%20Vive/lab1/" class="nav-list-link">Vive Lab 1: Building the Environment</a><li class="nav-list-item "> <a href="/decal/labs/HTC%20Vive/lab2/" class="nav-list-link">Vive Lab 2: Creating the Gun</a><li class="nav-list-item "> <a href="/decal/labs/HTC%20Vive/lab3/" class="nav-list-link">Vive Lab 3: The Monster</a><li class="nav-list-item active"> <a href="/decal/labs/HTC%20Vive/lab4/" class="nav-list-link active">Vive Lab 4: Putting It All Together</a></ul></ul><li class="nav-list-item"><a href="/decal/lectures/" class="nav-list-link">Lectures</a><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Final Project category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/decal/final-project/" class="nav-list-link">Final Project</a><ul class="nav-list "><li class="nav-list-item "><a href="/decal/final-project/project-resources/" class="nav-list-link">Project Resources</a></ul><li class="nav-list-item"><a href="/decal/extra-resources/" class="nav-list-link">Extra Resources</a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div></div></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/decal/labs/">Labs</a><li class="breadcrumb-nav-list-item"><a href="/decal/labs/HTC%20Vive/">HTC Vive</a><li class="breadcrumb-nav-list-item"><span>Vive Lab 4: Putting It All Together</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 class="no_toc" id="vive-lab-4-putting-it-all-together"> <a href="#vive-lab-4-putting-it-all-together" class="anchor-heading" aria-labelledby="vive-lab-4-putting-it-all-together"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Vive Lab 4: Putting It All Together</h1><h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents</h2><ul id="markdown-toc"><li><a href="#spawning-monsters" id="markdown-toc-spawning-monsters">Spawning Monsters</a><ul><li><a href="#debugging-exercise" id="markdown-toc-debugging-exercise">Debugging Exercise</a></ul><li><a href="#the-player" id="markdown-toc-the-player">The Player</a><li><a href="#final-remarks" id="markdown-toc-final-remarks">Final Remarks</a></ul><hr /><p>In the final lab of this series, we’ll be taking all of the components you learned about and created thus far and put them together into a single cohesive experience. We’ll also take care of some odds and ends that we didn’t get to in the previous labs.</p><p>Imagine the flow of the game, from initialization to finish. Here’s everything that needs to happen:</p><ul><li><p>Player puts on the headset and picks up the gun. <em>Done</em>.</p><li><p>Monsters start spawning periodically from preset locations and walk towards the player. <em>We’ve done the latter, but not the former</em>.</p><li><p>Players can shoot and kill monsters. <em>Done</em>.</p><li><p>Upon reaching the player, monsters will attack, causing the player to take damage. <em>We’ve done the former, but not the latter</em>.</p><li><p>Upon losing all health, the game restarts. <em>Not done</em>.</p></ul><p>You can download the skeleton package <a href="https://drive.google.com/file/d/12tQdeEr4EkIlDzzqkCJ_G3V2dKPRrwzv/view?usp=sharing"><strong>here</strong></a>.</p><p><em>Important: Certain parts of this lab have been left without explicit instruction. This is on purpose, and those parts must be completed in order to finish the lab.</em></p><h1 id="spawning-monsters"> <a href="#spawning-monsters" class="anchor-heading" aria-labelledby="spawning-monsters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Spawning Monsters</h1><p>To start things off, let’s update our monster prefab so that when we spawn it via script it has all the functionality the monster in our scene has. Select the monster gameobject and click Apply in its prefab options.</p><p><img src="/decal/assets/images/htc%20vive/lab4/1.PNG" alt="image" /></p><p>After you’ve done this, you can remove the monster within the scene - we don’t want to get assassinated the instant we start the game.</p><p>Next, create a script called SpawnManager. This script will manage the spawning process for the monsters. Declare in it the following public variables and stub in the Spawn() function.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class SpawnManager : MonoBehaviour {

    public Transform[] spawnLocations;

    public float spawnTime;

    public GameObject monsterPrefab;

    ...

    public void Spawn() {

    }

}
</code></pre></div></div><p>The variables are pretty self explanatory - spawnLocations will contain a list of locations (transforms) where monsters could spawn from, spawnTime is the time interval between spawns, and monsterPrefab is the gameobject that gets spawned.</p><p>Let’s fill out Spawn(). Every time this function gets called, we’ll want to choose a random transform to spawn it at. We’ll instantiate the monster, then position and rotate it accordingly.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void Spawn() {

    Transform spawn = spawnLocations[Random.Range(0, spawnLocations.Length)];

    GameObject monster = Instantiate(monsterPrefab, spawn.position, spawn.rotation);

}
</code></pre></div></div><p>Random.Range(x, y) returns a random integer between x inclusive and y exclusive. As a side note, if you feed it two floats instead, it’ll return you a random float instead.</p><p>Now we have to repeatedly call this function every couple seconds. While we could write a timer system in Update() using GetTime(), Unity actually has a function for this particular use case. Put the following line in the Start() function.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>void Start () {

    InvokeRepeating("Spawn", spawnTime, spawnTime);

}
</code></pre></div></div><p>InvokeRepeating is a Unity function that will call the function in the first argument after a certain amount of time, dictated by the second argument. It will then continue to call this function at set intervals (the third argument). In our case, Unity will call Spawn() after spawnTime seconds and continue to do so endlessly.</p><p>Let’s add the SpawnManager script to our game. Create a new empty gameobject called “SpawnManager”, and attach this script to it. Set Spawn Time to 5 and set the monster prefab correctly.</p><p><img src="/decal/assets/images/htc%20vive/lab4/2.PNG" alt="image" /></p><p>To fill in Spawn Locations, we’re going to create empty gameobjects (which contain only transforms) and position them around the map where we want monsters to spawn.</p><p>But where do we want to spawn them? The locations should be out of the player’s sight, so that they can’t see them pop into existence. They also have to be on the nav mesh, otherwise the spawned monster wouldn’t be able to navigate properly. To make sure we’re meeting these requirements, open up the navigation window, which should cause the blue navmesh to appear.</p><p>Create a couple empty gameobjects and call them Spawn (you can number them if you wish). Position them around the map such that they’re on the navmesh and out of the player’s line of sight.</p><p><img src="/decal/assets/images/htc%20vive/lab4/3.PNG" alt="image" /> <img src="/decal/assets/images/htc%20vive/lab4/4.PNG" alt="image" /> <img src="/decal/assets/images/htc%20vive/lab4/5.PNG" alt="image" /></p><p>Once you’re satisfied with your spawns, select SpawnManager and drag the spawns onto the Spawn Locations array to add to the list.</p><p><img src="/decal/assets/images/htc%20vive/lab4/6.PNG" alt="image" /></p><p>Give it a shot! Starting the game now should cause a monster to spawn once every 5 seconds, and… walk in place. Time for an exercise in debugging.</p><h2 id="debugging-exercise"> <a href="#debugging-exercise" class="anchor-heading" aria-labelledby="debugging-exercise"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Debugging Exercise</h2><p>Before continuing on with the lab, figure out why the monsters are walking in place and fix it so that the newly spawned monsters successfully navigate the environment and walk towards you after spawning. You might want to refer back to lab 4 for implementation details. If you’re feeling lost, we’ve listed some tips below that might help.</p><ol><li><p>Recall what you did during the last lab to make the monsters move. Since the monsters are playing their walk animation, it means they’re trying to move, but don’t know where to go. For what reason might this happen?</p><li><p>Start the game, then switch back to scene view and select one of the monsters to view it in the inspector. Are any of the properties incorrect?</p><li><p>Once you’ve isolated the cause, try to figure out why it’s happening (since your monster was working fine in the previous lab). What’s the difference between spawning a new monster from a prefab and having it in your scene in the first place?</p><li><p>Finally, once you understand the problem, come up with a solution to fix it. Remember that all public properties can be viewed and modified from any script.</p></ol><p>Hint: Prefabs cannot access any gameobjects from a specific scene. This is because prefabs have to work across all scenes, and even across different projects. For that reason, they cannot use anything that’s tied to a single scene.</p><h1 id="the-player"> <a href="#the-player" class="anchor-heading" aria-labelledby="the-player"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Player</h1><p>We’re now going to create a script to deal with player specific logic. Create and begin editing a new script called “Player”. Similar to the monster, we’ll want to track the player’s state (either alive or dead) with enums and also store the player’s health.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public enum State {

    ALIVE, DEAD

}

public State playerState = State.ALIVE;

public int maxHealth;

private int health;

void Start () {

    health = maxHealth;

}
</code></pre></div></div><p>There’s only one interaction we haven’t implemented yet for the player: getting hurt by monsters. Stub in the public Hurt() function.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void Hurt(int damage) {

}
</code></pre></div></div><p>This function is nearly identical to the Hurt() function in Monster.cs. Fill it out and stub in a Die() function as well.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void Hurt(int damage) {

    if (playerState == State.ALIVE) {

        health -= damage;

        if (health &lt;= 0) {

            Die();

        }

    }

}

void Die() {

}
</code></pre></div></div><p>What happens when the player dies? There’s a lot of things we could do, but for simplicity we’ll just restart the level. Unity gives you the ability to load up a new scene in its library UnityEngine.SceneManagement, so import it at the top of the file.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>using UnityEngine.SceneManagement;
</code></pre></div></div><p>Then in Die(), tell Unity to load up a new scene. We called our scene “Lab”, but make sure to feed in whatever you called your scene file.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>void Die() {

    SceneManager.LoadScene("Lab");

}
</code></pre></div></div><p>In Unity, add the player script to your ScriptManager gameobject and set Max Health to 100.</p><p>All that’s left is to call Hurt() whenever the player gets attacked by a monster. Switch to editing Monster.cs, and in it declare a damage variable and a reference to the Player script you just wrote.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public int damage;
</code></pre></div></div><p>Finally, modify the Attack() function so that it calls Hurt() appropriately to damage the player. As with the debugging exercise earlier, we will leave the implementation open-ended. Again, here are some tips:</p><ul><li><p>We now have two things called “player” in our project. The first one, “player” is a property you defined in Monster.cs during the previous lab and represents an item that gives us the location of the player (CameraRig). The second is Player.cs is the script that you just created. Don’t get mixed up between the two.</p><li><p>For monsters to be able to hurt the player, there needs to be some link between the monster script on on a spawned monster and the player script in the scene that you just added.</p><li><p>Remember that all components are scripts and vice-versa, from the ones default to Unity like Rigidbody or AudioSource, to the ones you created and added to a gameobject yourself.</p></ul><p>Try it out! When monsters attack you up to 5 times now, the scene should restart (indicating that you’ve lost).</p><h1 id="final-remarks"> <a href="#final-remarks" class="anchor-heading" aria-labelledby="final-remarks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Final Remarks</h1><p>Congratulations! You now have a fully implemented game that you’ve created for the HTC Vive. There are a ton of things that could be added and improved, of course, such as moving the trigger of the gun or and adding screen effects to the camera (for the curious, that’s what the Flash script is for). We hope that this lab series gave you enough knowledge and familiarity with Unity/HTC Vive to improve or kickstart your own projects.</p><p><em>To check off, show a facilitator that the entire game works - that you can operate the gun, that monsters spawn and move towards you, that you can defeat monsters, and that they can defeat you.</em></p></div></div></div>
